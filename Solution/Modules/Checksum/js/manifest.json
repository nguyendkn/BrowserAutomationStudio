{
    "actions": [
		{
            "code": [
                {
                    "file": "Checksum_String_code.js",
                    "name": "Checksum_String_code"
                }
            ],
            "description": {
                "en": "String checksum",
                "ru": "Контрольная сумма строки"
            },
            "interface": "Checksum_String_interface.js",
            "is_element": false,
            "name": "Checksum_String",
            "select": "Checksum_String_select.js",
            "template": "{{input}} -> {{Save}}"
        },
        {
            "code": [
                {
                    "file": "Checksum_File_code.js",
                    "name": "Checksum_File_code"
                }
            ],
            "description": {
                "en": "File checksum",
                "ru": "Контрольная сумма файла"
            },
            "interface": "Checksum_File_interface.js",
            "is_element": false,
            "name": "Checksum_File",
            "select": "Checksum_File_select.js",
            "template": "{{filePath}} -> {{Save}}"
        }
    ],
    "api_version": 1,
    "autogenerated_functions": [
        "Checksum_String",
        "Checksum_File"
    ],
    "browser": [
    ],
    "depends": [
    ],
    "description": "Checksum calculation",
    "description_small": {
        "en": "Checksum",
        "ru": "Контрольная сумма"
    },
    "developer_email": "sasha9817@mail.ru",
    "developer_name": "GhostZ",
    "developer_site": "https://t.me/GhostZed",
    "embeddeddata": [
        {
            "Data": "const self = this;\nconst { Transform } = require(\"stream\");\nconst ERR_CRYPTO_HASH_FINALIZED = new Error(global.lang==\"ru\" ? 'Digest уже вызывался.' : 'Digest already called.');\nconst ERR_CRYPTO_ALGORITHM_NOT_SPECIFIED = new Error(global.lang==\"ru\" ? 'Алгоритм не указан.' : 'Algorithm not specified.');\nconst ERR_CRYPTO_UNSUPPORTED_ALGORITHM = new Error(global.lang==\"ru\" ? 'Указан неподдерживаемый алгоритм.' : 'Unsupported algorithm specified.');\n\nthis.error = function(err){\n    throw (global.lang==\"ru\" ? 'Не удалось рассчитать контрольную сумму' : 'Failed to calculate checksum') + ', ' + (err.message || err);\n};\n\nthis.setLang = function(lang){\n    if(!global.lang || global.lang !== lang){\n        global.lang = lang;\n    };\n};\n\nclass crcHash extends Transform {\n    constructor(handler, resultSize){\n        super();\n        Transform.call(this);\n        this.handler = handler;\n        this.finalized = false;\n        this.resultSize = resultSize;\n        this.value = undefined;\n    };\n    \n    getResultBuffer(){\n        let buffer = new Buffer(4);\n        buffer.writeUInt32BE(this.value || 0, 0);\n        if(this.resultSize){\n            buffer = buffer.slice(4 - this.resultSize);\n        };\n        return buffer;\n    };\n\n    _transform(chunk, encoding, callback){\n        this.value = this.handler(chunk, this.value);\n        callback();\n    };\n\n    _flush(callback){\n        let buffer = this.getResultBuffer();\n        this.push(buffer);\n        callback();\n    };\n\n    update(data, encoding){\n        if(this.finalized){\n            throw ERR_CRYPTO_HASH_FINALIZED;\n        };\n        if(!(data instanceof Buffer)){\n            data = new Buffer(data, encoding);\n        };\n        this.value = this.handler(data, this.value);\n        return this;\n    };\n\n    digest(encoding){\n        if(this.finalized){\n            throw ERR_CRYPTO_HASH_FINALIZED;\n        };\n        let ret = this.getResultBuffer().toString(encoding);\n        this.finalized = true;\n        return ret;\n    };\n};\n\nthis.createCrcHash = function(algorithm){\n    let crc = require(\"crc\");\n    if(!algorithm){\n        throw ERR_CRYPTO_ALGORITHM_NOT_SPECIFIED;\n    };\n    if(!crc.hasOwnProperty(algorithm)){\n        throw ERR_CRYPTO_UNSUPPORTED_ALGORITHM;\n    };\n    let size = null;\n    switch(algorithm){\n        case \"crc1\":\n        case \"crc8\":\n        case \"crc81wire\":\n            size = 1;\n            break;\n        case \"crc16\":\n        case \"crc16ccitt\":\n        case \"crc16modbus\":\n        case \"crc16kermit\":\n        case \"crc16xmodem\":\n            size = 2;\n            break;\n        case \"crc24\":\n            size = 3;\n            break;\n        case \"crc32\":\n        case \"crcjam\":\n            size = 4;\n            break;\n    };\n    return new crcHash(crc[algorithm], size);\n};",
            "DataName": "UtilChecksum",
            "DataType": 1,
            "LanguageName": "Node",
            "LanguageVersion": "12.18.3"
        },
        {
            "Data": "const crypto = require('crypto');\r\nconst util = require(\"../UtilChecksum\");\r\nlet {input, algorithm, base64, encoding, outputFormat, lang} = [[CHECKSUM_NODE_PARAMETERS]];\r\nutil.setLang(lang);\r\n\r\ntry{\r\n    let hash = (algorithm.startsWith('crc') ? util.createCrcHash : crypto.createHash)(algorithm);\r\n    hash.update(input, base64 ? 'base64' : encoding);\r\n    [[CHECKSUM_NODE_PARAMETERS]] = hash.digest(outputFormat);\r\n}catch(err){\r\n    util.error(err, lang);\r\n};",
            "DataName": "Checksum_String",
            "DataType": 0,
            "LanguageName": "Node",
            "LanguageVersion": "12.18.3"
        },
        {
            "Data": "const crypto = require('crypto');\r\nconst fs = require('fs');\r\nconst util = require(\"../UtilChecksum\");\r\nlet {filePath, algorithm, outputFormat, lang} = [[CHECKSUM_NODE_PARAMETERS]];\r\nutil.setLang(lang);\r\n\r\ntry{\r\n    [[CHECKSUM_NODE_PARAMETERS]] = await (new Promise((resolve, reject) => {\r\n        let hash = (algorithm.startsWith('crc') ? util.createCrcHash : crypto.createHash)(algorithm);\r\n        let stream = fs.createReadStream(filePath);\r\n        stream.on('error', function(err){\r\n            if(err.message.includes(\"no such file or directory\")){\r\n                reject(global.lang==\"ru\" ? (`файл \"${filePath}\" не существует`) : (`file \"${filePath}\" does not exist`));\r\n            }else{\r\n                reject(err);\r\n            };\r\n        });\r\n        stream.on('data', function(data){\r\n            hash.update(data);\r\n        });\r\n        stream.on('end', function(){\r\n            resolve(hash.digest(outputFormat));\r\n        });\r\n    }));\r\n}catch(err){\r\n     util.error(err);\r\n};",
            "DataName": "Checksum_File",
            "DataType": 0,
            "LanguageName": "Node",
            "LanguageVersion": "12.18.3"
        }
    ],
    "engine": [
        "engine.js"
    ],
    "icon": "Checksum.png",
    "info": {
        "en": "Module for calculating the checksum of a string or file",
        "ru": "Модуль для расчета контрольной суммы строки или файла"
    },
    "is_autogenerated": true,
    "languages": [
        {
            "Name": "Node",
            "Version": "12.18.3"
        }
    ],
    "localize": {
		"String": {"ru":"Строка"},
		"Algorithm": {"ru":"Алгоритм"},
		"Output format": {"ru":"Формат вывода"},
		"Is base64 encoded": {"ru":"Закодирована в base64"},
		"Calculate the checksum of the specified string.": {"ru":"Рассчитать контрольную сумму указанной строки."},
		
		"File path": {"ru":"Путь к файлу"},
		"Calculate the checksum of the specified file.": {"ru":"Рассчитать контрольную сумму указанного файла."}
    },
    "major_version": 1,
    "minor_version": 0,
    "modules": [
        {
            "LanguageName": "Node",
            "LanguageVersion": "12.18.3",
            "ModuleName": "crc",
            "ModuleVersion": "*"
        }
    ],
    "name": "Checksum"
}
