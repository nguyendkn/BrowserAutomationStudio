{
    "actions": [
        {
            "code": [
                {
                    "file": "Archive_Unpack_code.js",
                    "name": "Archive_Unpack_code"
                }
            ],
            "description": {
                "en": "Unpack archive",
                "ru": "Распаковать архив"
            },
            "interface": "Archive_Unpack_interface.js",
            "is_element": false,
            "name": "Archive_Unpack",
            "select": "Archive_Unpack_select.js",
            "template": "{{ArchivePath}} -> {{DestinationPath}}",
            "suggestion":{"en": "zip, rar, 7z, unzip","ru": "zip, rar, 7z, разархивировать"}

        },
		{
            "code": [
                {
                    "file": "Archive_ArchiveFolder_code.js",
                    "name": "Archive_ArchiveFolder_code"
                }
            ],
            "description": {
                "en": "Archive folder",
                "ru": "Заархивировать папку"
            },
            "interface": "Archive_ArchiveFolder_interface.js",
            "is_element": false,
            "name": "Archive_ArchiveFolder",
            "select": "Archive_ArchiveFolder_select.js",
            "template": "{{FolderPath}} -> {{DestinationPath}}",
            "suggestion":{"en": "zip, rar, 7z, unzip","ru": "zip, rar, 7z, разархивировать"}
        },
		{
            "code": [
                {
                    "file": "Archive_ArchiveFiles_code.js",
                    "name": "Archive_ArchiveFiles_code"
                }
            ],
            "description": {
                "en": "Archive files",
                "ru": "Заархивировать файлы"
            },
            "interface": "Archive_ArchiveFiles_interface.js",
            "is_element": false,
            "name": "Archive_ArchiveFiles",
            "select": "Archive_ArchiveFiles_select.js",
            "template": "{{DestinationPath}}",
            "suggestion":{"en": "zip, rar, 7z, create archive","ru": "zip, rar, 7z, запаковать"}
        },
		{
            "code": [
                {
                    "file": "Archive_GetFileList_code.js",
                    "name": "Archive_GetFileList_code"
                }
            ],
            "description": {
                "en": "Get file list from archive",
                "ru": "Получить список файлов из архива"
            },
            "interface": "Archive_GetFileList_interface.js",
            "is_element": false,
            "name": "Archive_GetFileList",
            "select": "Archive_GetFileList_select.js",
            "template": "{{ArchivePath}} -> {{Save}}",
            "suggestion":{"en": "zip, rar, 7z, create archive","ru": "zip, rar, 7z, запаковать"}
        }
    ],
    "api_version": 1,
    "autogenerated_functions": [
        "Archive_Unpack",
		"Archive_ArchiveFolder",
		"Archive_ArchiveFiles",
		"Archive_GetFileList"
    ],
    "browser": [
    ],
    "depends": [
    ],
    "description": "Working with archives",
    "description_small": {
        "en": "Archive",
        "ru": "Архив"
    },
    "developer_email": "sasha9817@mail.ru",
    "developer_name": "GhostZ",
    "developer_site": "https://t.me/GhostZed",
    "embeddeddata": [
        {
            "Data": "const fs = require('fs');\r\nconst path = require('path');\r\nconst unzipper = require(\"unzipper\");\r\nconst il = require('iconv-lite');\r\n\r\nvar archive_path = [[ARCHIVE_UNPACK_PARAMETERS]][0];\r\nvar destination_path = [[ARCHIVE_UNPACK_PARAMETERS]][1];\r\nvar list_of_files = [[ARCHIVE_UNPACK_PARAMETERS]][2];\r\nvar unpack_all = list_of_files.length<=0;\r\n\r\nfunction ensureDirectoryExistence(filePath) {\r\n    var dirname = path.dirname(filePath);\r\n    if(fs.existsSync(dirname)){\r\n        return true;\r\n    };\r\n    ensureDirectoryExistence(dirname);\r\n    fs.mkdirSync(dirname);\r\n};\r\n\r\nawait (new Promise((resolve, reject) => {\r\n    var readStream = fs.createReadStream(archive_path);\r\n    readStream.on(\"error\", function error(e){\r\n        reject(e);\r\n    });\r\n    var parse = readStream.pipe(unzipper.Parse());\r\n    parse.on('entry', function (entry){\r\n        var isUnicode = entry.props.flags.isUnicode;\r\n        var filePath = isUnicode ? entry.path : il.decode(entry.props.pathBuffer, 'cp866');\r\n        var fullPath = destination_path + '/' + filePath;\r\n        var fileType = entry.type;\r\n        if(unpack_all || list_of_files.indexOf(filePath) > -1){\r\n            if(fileType===\"File\"){\r\n                ensureDirectoryExistence(fullPath);\r\n                var writeStream = entry.pipe(fs.createWriteStream(fullPath));\r\n                writeStream.on(\"error\", function error(e) {\r\n                    reject(e);\r\n                });\r\n            }else{\r\n                if(!fs.existsSync(fullPath)){\r\n                    ensureDirectoryExistence(fullPath);\r\n                    fs.mkdirSync(fullPath);\r\n                };\r\n                var autodrain = entry.autodrain();\r\n                autodrain.on(\"error\", function error(e) {\r\n                    reject(e);\r\n                });\r\n            };\r\n        }else{\r\n            var autodrain = entry.autodrain();\r\n            autodrain.on(\"error\", function error(e) {\r\n                reject(e);\r\n            });\r\n        };\r\n    });\r\n    parse.on(\"error\", function error(e) {\r\n        reject(e);\r\n    });\r\n    parse.on(\"close\", function close() {\r\n        resolve();\r\n    });\r\n}));",
            "DataName": "UnpackZIP",
            "DataType": 0,
            "LanguageName": "Node",
            "LanguageVersion": "12.18.3"
        },
        {
            "Data": "const unrarp = require('unrar-promise');\r\n\r\nvar archive_path = [[ARCHIVE_UNPACK_PARAMETERS]][0];\r\nvar destination_path = [[ARCHIVE_UNPACK_PARAMETERS]][1];\r\nvar list_of_files = [[ARCHIVE_UNPACK_PARAMETERS]][2];\r\nvar unpack_all = list_of_files.length<=0;\r\nvar list_of_files = unpack_all ? [] : list_of_files.map(function(f){return f.split(\"/\").join(\"\\\\\")});\r\n\r\nawait (new Promise((resolve, reject) => {\r\n\tvar unrar = unrarp.unrar(archive_path, destination_path, {filter({path, type}){return unpack_all || list_of_files.indexOf(path) > -1},overwrite: true});\r\n    unrar.then(function(result){\r\n        resolve();\r\n    })\r\n    unrar.catch(function(err){\r\n        reject(err);\r\n    });\r\n}));",
            "DataName": "UnpackRAR",
            "DataType": 0,
            "LanguageName": "Node",
            "LanguageVersion": "12.18.3"
        },
        {
            "Data": "const pathTo7zip = require('7zip-bin').path7za;\r\nconst Seven = require('node-7z');\r\n\r\nvar archive_path = [[ARCHIVE_UNPACK_PARAMETERS]][0];\r\nvar destination_path = [[ARCHIVE_UNPACK_PARAMETERS]][1];\r\nvar list_of_files = [[ARCHIVE_UNPACK_PARAMETERS]][2];\r\n\r\nawait (new Promise((resolve, reject) => {\r\n    var extract = Seven.extractFull(archive_path, destination_path, {\r\n        $bin: pathTo7zip,\r\n        charset: 'UTF-8',\r\n        overwrite: 'a',\r\n        $cherryPick: list_of_files\r\n    })\r\n    extract.on(\"error\", function error(err){\r\n        reject(err);\r\n    }); \r\n    extract.on('end', function(){\r\n        resolve();\r\n    });\r\n}));",
            "DataName": "Unpack7Z",
            "DataType": 0,
            "LanguageName": "Node",
            "LanguageVersion": "12.18.3"
        },
        {
            "Data": "const fs = require('fs');\r\nconst archiver = require('archiver');\r\n\r\nvar folder_path = [[ARCHIVE_FOLDER_PARAMETERS]][0];\r\nvar destination_path = [[ARCHIVE_FOLDER_PARAMETERS]][1];\r\nvar folder_name = [[ARCHIVE_FOLDER_PARAMETERS]][2];\r\n\r\nawait (new Promise((resolve, reject) => {\r\n    var archive = archiver('zip').directory(folder_path, folder_name);\r\n    var writeStream = archive.pipe(fs.createWriteStream(destination_path));\r\n    archive.finalize();\r\n    archive.on('error', function(e){\r\n        reject(e);\r\n    });\r\n    writeStream.on('error', function(e){\r\n        reject(e);\r\n    });\r\n    writeStream.on('close', function close(){\r\n        resolve();\r\n    });\r\n}));\r\n",
            "DataName": "ArchiveFolderZIP",
            "DataType": 0,
            "LanguageName": "Node",
            "LanguageVersion": "12.18.3"
        },
        {
            "Data": "const pathTo7zip = require('7zip-bin').path7za;\r\nconst Seven = require('node-7z');\r\n\r\nvar folder_path = [[ARCHIVE_FOLDER_PARAMETERS]][0];\r\nvar destination_path = [[ARCHIVE_FOLDER_PARAMETERS]][1];\r\n\r\nawait (new Promise((resolve, reject) => {\r\n    var delete_old = Seven.delete(destination_path, '*', {$bin: pathTo7zip});\r\n    delete_old.on(\"error\", function error(err){\r\n        reject(err);\r\n    }); \r\n    var extract = Seven.add(destination_path, folder_path, {\r\n        $bin: pathTo7zip,\r\n        overwrite: 'a',\r\n        charset: 'UTF-8'\r\n    })\r\n    extract.on(\"error\", function error(err){\r\n        reject(err);\r\n    }); \r\n    extract.on('end', function(){\r\n        resolve();\r\n    });\r\n}));",
            "DataName": "ArchiveFolder7Z",
            "DataType": 0,
            "LanguageName": "Node",
            "LanguageVersion": "12.18.3"
        },
		{
            "Data": "const fs = require('fs');\r\nconst archiver = require('archiver');\r\n\r\nvar list_of_files = [[ARCHIVE_FILES_PARAMETERS]][0];\r\nvar destination_path = [[ARCHIVE_FILES_PARAMETERS]][1];\r\n\r\nawait (new Promise((resolve, reject) => {\r\n    var archive = archiver('zip');\r\n    list_of_files.forEach(function(e){\r\n        if(e.isFolder){\r\n            archive.directory(e.path, e.name);\r\n        }else{\r\n            archive.file(e.path, {name: e.name});\r\n        }\r\n    });\r\n    var writeStream = archive.pipe(fs.createWriteStream(destination_path));\r\n    archive.finalize();\r\n    archive.on('error', function(e){\r\n        reject(e);\r\n    });\r\n    writeStream.on('error', function(e){\r\n        reject(e);\r\n    });\r\n    writeStream.on('close', function close(){\r\n        resolve();\r\n    });\r\n}));\r\n",
            "DataName": "ArchiveFilesZIP",
            "DataType": 0,
            "LanguageName": "Node",
            "LanguageVersion": "12.18.3"
        },
        {
            "Data": "const pathTo7zip = require('7zip-bin').path7za;\r\nconst Seven = require('node-7z');\r\n\r\nvar list_of_files = [[ARCHIVE_FILES_PARAMETERS]][0].map(function(f){return f.path});\r\nvar destination_path = [[ARCHIVE_FILES_PARAMETERS]][1];\r\n\r\nawait (new Promise((resolve, reject) => {\r\n    var delete_old = Seven.delete(destination_path, '*', {$bin: pathTo7zip});\r\n    delete_old.on(\"error\", function error(err){\r\n        reject(err);\r\n    }); \r\n    var extract = Seven.add(destination_path, list_of_files, {\r\n        $bin: pathTo7zip,\r\n        overwrite: 'a',\r\n        charset: 'UTF-8'\r\n    });\r\n    extract.on(\"error\", function error(err){\r\n        reject(err);\r\n    }); \r\n    extract.on('end', function(){\r\n        resolve();\r\n    });\r\n}));",
            "DataName": "ArchiveFiles7Z",
            "DataType": 0,
            "LanguageName": "Node",
            "LanguageVersion": "12.18.3"
        },
		{
            "Data": "const unzipper = require(\"unzipper\");\r\nconst fs = require('fs');\r\nconst il = require('iconv-lite');\r\n\r\nvar archive_path = [[ARCHIVE_GETFILELIST_PARAMETERS]];\r\nvar list_of_files = [];\r\n\r\nawait (new Promise((resolve, reject) => {\r\n    var readStream = fs.createReadStream(archive_path);\r\n    readStream.on(\"error\", function error(e) {\r\n        reject(e);\r\n    });\r\n    var parse = readStream.pipe(unzipper.Parse());\r\n    parse.on('entry', function (entry){\r\n        var isUnicode = entry.props.flags.isUnicode;\r\n        var filePath = isUnicode ? entry.path : il.decode(entry.props.pathBuffer, 'cp866');\r\n        list_of_files.push(filePath);\r\n        var autodrain = entry.autodrain();\r\n        autodrain.on(\"error\", function error(e) {\r\n            reject(e);\r\n        });\r\n    });\r\n    parse.on(\"error\", function error(e) {\r\n        reject(e);\r\n    });\r\n    parse.on(\"close\", function close() {\r\n        [[ARCHIVE_GETFILELIST_PARAMETERS]] = list_of_files;\r\n        resolve();\r\n    });\r\n}));",
            "DataName": "GetFileListZIP",
            "DataType": 0,
            "LanguageName": "Node",
            "LanguageVersion": "12.18.3"
        },
        {
            "Data": "const unrarp = require('unrar-promise');\r\n\r\nvar archive_path = [[ARCHIVE_GETFILELIST_PARAMETERS]];\r\n\r\nawait (new Promise((resolve, reject) => {\r\n\tvar list = unrarp.list(archive_path);\r\n    list.then(function(result){\r\n        [[ARCHIVE_GETFILELIST_PARAMETERS]] = result.sort().map(function(f){return f.split(\"\\\\\").join(\"/\")});\r\n        resolve();\r\n    })\r\n    list.catch(function(err){\r\n        reject(err);\r\n    });\r\n}));",
            "DataName": "GetFileListRAR",
            "DataType": 0,
            "LanguageName": "Node",
            "LanguageVersion": "12.18.3"
        },
        {
            "Data": "const pathTo7zip = require('7zip-bin').path7za;\r\nconst Seven = require('node-7z');\r\n\r\nvar archive_path = [[ARCHIVE_GETFILELIST_PARAMETERS]];\r\nvar list_of_files = [];\r\n\r\nawait (new Promise((resolve, reject) => {\r\n    var list = Seven.list(archive_path, {\r\n        $bin: pathTo7zip,\r\n        charset: 'UTF-8'\r\n    })\r\n    list.on(\"error\", function error(err){\r\n        reject(err);\r\n    });\r\n    list.on('data', function(data){\r\n        list_of_files.push(data.file);\r\n    });\r\n    list.on('end', function(){\r\n        [[ARCHIVE_GETFILELIST_PARAMETERS]] = list_of_files.sort();\r\n        resolve();\r\n    });\r\n}));",
            "DataName": "GetFileList7Z",
            "DataType": 0,
            "LanguageName": "Node",
            "LanguageVersion": "12.18.3"
        }
    ],
    "engine": [
        "engine.js"
    ],
    "icon": "Archive.png",
    "info": {
        "en": "Module for working with archives",
        "ru": "Модуль для работы с архивами"
    },
    "is_autogenerated": true,
    "languages": [
        {
            "Name": "Node",
            "Version": "12.18.3"
        }
    ],
    "localize": {
		"File": {"ru":"Файл"},
		"is empty": {"ru":"пуст"},
		"Archive type": {"ru":"Тип архива"},
		"Folder path": {"ru":"Путь к папке"},
		"Archive path": {"ru":"Путь к архиву"},
		"List of files": {"ru":"Список файлов"},
		"Can be blank": {"ru":"Может быть пустым"},
		"Destination path": {"ru":"Путь назначения"},
		"in the destination path": {"ru":"в пути назначения"},
		"The archive will be completely unpacked": {"ru":"Архив будет распакован полностью"},
		"Place archive next to the original folder": {"ru":"Поместите архив рядом с исходной папкой"},
		"Place the contents of the archive next to it": {"ru":"Поместить содержимое архива рядом с ним"},
		"This action only works with zip archives.": {"ru":"Данное действие работает только с zip архивами."},
		"Get a list of files contained in the archive.": {"ru":"Получить список файлов содержащихся в архиве."},
		"The path to the archive which needs to be unpacked.": {"ru":"Путь к архиву который нужно распаковать."},
		"The path to the folder which needs to be archived.": {"ru":"Путь к папке которую нужно заархивировать."},
		"The path to the file which needs be added to archive.": {"ru":"Путь к файлу, который нужно добавить в архив."},
		"The path to the location where the archive will be saved.": {"ru":"Путь к месту в которое будет сохранен архив."},
		"This action works with both files and folders.": {"ru":"Данное действие работает как с файлами, так и с папками."},
		"The archive type will be determined by the file extension": {"ru":"Тип архива будет определен по расширению файла"},
		"Unpack the contents of the archive to the specified location.": {"ru":"Распаковать содержимое архива в указанное место."},
		"Archive files and save the archive to the specified location.": {"ru":"Заархивировать файлы, и сохранить архив в указанное место."},
		"Archive folder and save the archive to the specified location.": {"ru":"Заархивировать папку, и сохранить архив в указанное место."},
		"The path to the archive from which needs to get the list of files.": {"ru":"Путь к архиву из которого нужно получить список файлов."},
		"The list can be created using actions from the \"List\" module.": {"ru":"Список можно создать с помощью действий из модуля \"Список\"."},
		"The parameters \"File 1\", \"File 2\", \"File 3\" will be used": {"ru":"Будут использованы параметры \"Файл 1\", \"Файл 2\", \"Файл 3\""},
		"If a non-existent destination path is specified, it will be created.": {"ru":"Если указан несуществующий путь назначения, он будет создан."},
		"The resulting list can be used in the \"Unpack archive\" action.": {"ru":"Полученный список можно использовать в действии \"Распаковать архив\"."},
		"The path to the location where the contents of the archive will be unpacked.": {"ru":"Путь к месту в которое будет распаковано содержимое архива."},
		"The parameters \"File 2\", \"File 3\", \"List of files\" will be used": {"ru":"Будут использованы параметры \"Файл 2\", \"Файл 3\", \"Список файлов\""},
		"The parameters \"File 1\", \"File 3\", \"List of files\" will be used": {"ru":"Будут использованы параметры \"Файл 1\", \"Файл 3\", \"Список файлов\""},
		"The parameters \"File 1\", \"File 2\", \"List of files\" will be used": {"ru":"Будут использованы параметры \"Файл 1\", \"Файл 2\", \"Список файлов\""},
		"The resulting list can be processed using actions from the \"List\" module.": {"ru":"Полученный список можно обработать с помощью действий из модуля \"Список\"."},
		"The list of files should contain not only their names but their path in the archive.": {"ru":"Список файлов должен содержать не только их названия, но и их путь в архиве."},
		"If with same name archive already exists along the destination path, it will be overwritten.": {"ru":"Если архив с таким именем уже существует по пути назначения, то он будет перезаписан."},
		"The resulting list will contain not only the names of the files, but their path in the archive.": {"ru":"Полученный список будет содержать не только названия файлов, но их путь в архиве."},
		"Files from separate fields and the list are added to a general list of files that will be archived.": {"ru":"Файлы из отдельных полей и списка складываются в общий список файлов которые будут заархивированы."},
		"If the destination path is not specified, the archive will be unpacked to the location where it is located.": {"ru":"Если путь назначения не указан, архив будет распакован в то место, в котором он находится."},
		"If the files contained in the archive already exist along the destination path, they will be overwritten.": {"ru":"Если по пути назначения уже существуют файлы содержащиеся в архиве, то они будут перезаписаны."},
		"List of paths to the files which needs be added to archive. The list can be created using actions from the \"List\" module.": {"ru":"Список путей к файлам, которые нужно добавить в архив. Список можно создать с помощью действий из модуля \"Список\"."},
		"The list of files can be obtained using the \"Get file list from archive\" action or create using actions from the \"List\" module.": {"ru":"Список файлов можно получить с помощью действия \"Получить список файлов из архива\" или создать с помощью действий из модуля \"Список\"."},
		"This action can unpack not the entire archive, but only a part of it, for this you need to specify a list of files that need to be unpacked.": {"ru":"Данное действие может распаковывать не весь архив, а только его часть, для этого нужно указать список файлов которые нужно распаковать."},
		"If some of the parameters (\"File 1\", \"File 2\", \"File 3\", \"List of files\") are not specified, all parameters will be used except for them.": {"ru":"Если какие-то из параметров (\"Файл 1\", \"Файл 2\", \"Файл 3\", \"Список файлов\") не указаны, будут использованы все параметры кроме них."},
		"For example, if a file is specified in the \"File 1\" field and a list of 4 files is specified in the \"List of files\" field, then 5 files will be archived.": {"ru":"Например, если в поле \"Файл 1\" указан файл и в поле \"Список файлов\" указан список из 4 файлов, то заархивировано будет 5 файлов."},
		"If an error occurred while execute action, the thread will stop with fail message. If you want to continue thread, use \"Ignore errors\" action.":{"ru":"Если во время выполнения действия произойдет ошибка, поток остановится с сообщением об ошибке. Если вы хотите продолжить работу, используйте действие \"Игнорировать ошибки\"."},
		"If the destination path is not specified, the archive will be saved to the location where the folder is located and will have the folder name and archive type in the extension.": {"ru":"Если путь назначения не указан, архив будет сохранен в то место, в котором находится папка и будет иметь её название и тип архива в расширении."},
		"The archive type is usually written in the file extension. But there are exceptions, such as Chrome extensions files have the extension .crx, but are zip archive with additional headers.": {"ru":"Тип архива обычно пишется в расширении файла. Но бывают и исключения, например файлы расширений Chrome имеют расширение .crx, но являются zip архивом с дополнительными заголовками."},
		"Variable in which, after successful completion of the action, will be recorded list of files contained in the archive. The list will contain not only the names of the files but their path in the archive.": {"ru":"Переменная в которую, после успешного выполнения действия, будет записан список файлов содержащихся в архиве. Список будет содержать не только названия файлов но их путь в архиве."},
		"If the archive has incorrect format or an error occurred while execute action, the thread will stop with fail message. If you want to continue thread, use \"Ignore errors\" action.":{"ru":"Если архив будет иметь неверный формат или во время выполнения действия произойдет ошибка, поток остановится с сообщением об ошибке. Если вы хотите продолжить работу, используйте действие \"Игнорировать ошибки\"."},
		"List of files to extract from the archive. The list should contain not only the names of the files but their path in the archive. The list can be obtained using the \"Get file list from archive\" action or create using actions from the \"List\" module.": {"ru":"Список файлов которые нужно извлечь из архива. Список должен содержать не только названия файлов но их путь в архиве. Список можно получить с помощь действия \"Получить список файлов из архива\" или создать с помощью действий из модуля \"Список\"."},
		"For example, if \"List of files\" is not specified, then the list will be formed from the parameters \"File 1\" and \"File 2\" and \"File 3\". If the parameters \"File 1\", \"File 2\", \"File 3\" are empty, then the \"List of files\" will be used. If all parameters are specified, then all of them will be used.": {"ru":"Например, если \"Список файлов\" не указан, то список будет сформирован из параметров \"Файл 1\" и \"Файл 2\" и \"Файл 3\". Если параметры \"Файл 1\", \"Файл 2\", \"Файл 3\" пусты, то будет использован \"Список файлов\". Если указаны все параметры, то все они будут использованы."}
    },
    "major_version": 1,
    "minor_version": 0,
    "modules": [
        {
            "LanguageName": "Node",
            "LanguageVersion": "12.18.3",
            "ModuleName": "unzipper",
            "ModuleVersion": "*"
        },
        {
            "LanguageName": "Node",
            "LanguageVersion": "12.18.3",
            "ModuleName": "iconv-lite",
            "ModuleVersion": "*"
        },
        {
            "LanguageName": "Node",
            "LanguageVersion": "12.18.3",
            "ModuleName": "archiver",
            "ModuleVersion": "*"
        },
        {
            "LanguageName": "Node",
            "LanguageVersion": "12.18.3",
            "ModuleName": "unrar-promise",
            "ModuleVersion": "*"
        },
        {
            "LanguageName": "Node",
            "LanguageVersion": "12.18.3",
            "ModuleName": "node-7z",
            "ModuleVersion": "*"
        },
        {
            "LanguageName": "Node",
            "LanguageVersion": "12.18.3",
            "ModuleName": "7zip-bin",
            "ModuleVersion": "*"
        }
    ],
    "name": "Archive"
}
