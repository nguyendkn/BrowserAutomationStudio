{
    "actions": [
		{
            "code": [
                {
                    "file": "SQL_Setup_code.js",
                    "name": "SQL_Setup_code"
                }
            ],
            "description": {
                "en": "Setup connection",
                "ru": "Настроить соединение"
            },
            "interface": "SQL_Setup_interface.js",
            "is_element": false,
            "name": "SQL_Setup",
            "select": "SQL_Setup_select.js",
            "template": "{{dialect}}:{{host}}:{{storage}}"
        },
        {
            "code": [
                {
                    "file": "SQL_Query_code.js",
                    "name": "SQL_Query_code"
                }
            ],
            "description": {
                "en": "Execute query",
                "ru": "Выполнить запрос"
            },
            "interface": "SQL_Query_interface.js",
            "is_element": false,
            "name": "SQL_Query",
            "select": "SQL_Query_select.js",
            "template": "{{query}}"
        },
        {
            "code": [
                {
                    "file": "SQL_Close_code.js",
                    "name": "SQL_Close_code"
                }
            ],
            "description": {
                "en": "Close connection",
                "ru": "Закрыть соединение"
            },
            "interface": "SQL_Close_interface.js",
            "is_element": false,
            "name": "SQL_Close",
            "select": "SQL_Close_select.js",
            "template": ""
        }
    ],
    "api_version": 1,
    "autogenerated_functions": [
        "SQL_Setup",
        "SQL_Query",
        "SQL_Close"
    ],
    "browser": [
    ],
    "depends": [
    ],
    "description": "Working with SQL databases",
    "description_small": {
        "en": "SQL",
        "ru": "SQL"
    },
    "developer_email": "sasha9817@mail.ru",
    "developer_name": "GhostZ",
    "developer_site": "https://t.me/GhostZed",
    "embeddeddata": [
        {
            "Data": "const Sequelize = require('sequelize');\n\nthis.connect_sql = function(id, config, done){\n    var dialect = config.dialect;\n\n    if(typeof sql_connections==\"undefined\"){\n        sql_connections = {};\n    };\n\n    if(typeof sql_connections[id]==\"undefined\"){\n        sql_connections[id] = {};\n    };\n\n    if(typeof sql_connections[id][dialect]==\"undefined\" || JSON.stringify(sql_connections[id][dialect].config)!=JSON.stringify(config)){\n        var options = {dialect:dialect}\n        if(config.database){\n            options.database = config.database;\n        };\n        if(config.username){\n            options.username = config.username;\n        };\n        if(config.password){\n            options.password = config.password;\n        };\n        if(config.host){\n            options.host = config.host;\n        };\n        if(config.port){\n            options.port = config.port;\n        };\n        if(dialect===\"sqlite\"){\n            if(config.storage){\n                options.storage = config.storage;\n            };\n            options.dialectModule = require('sqlite3-offline').verbose();\n            if(false){\n                options.dialectModulePath = __dirname.split(\"\\\\\").join(\"/\").split(\"/lib\")[0] + \"/node_modules/sqlite3-offline\";\n            };\n        };\n        sql_connections[id][dialect] = {\n            id: id,\n            dialect: dialect,\n            config: config,\n            sequelize: new Sequelize(options),\n            timeout: 0,\n            close: function(sql){\n                sql.sequelize.close();\n                return sql.delete();\n            },\n            setTimeout: function(timeout){this.timeout = setTimeout(this.close, timeout, this)},\n            clearTimeout: function(){clearTimeout(this.timeout)},\n            delete: function(){delete sql_connections[this.id][this.dialect]}\n        };\n        var sql_obj = sql_connections[id][dialect];\n        var connect = sql_obj.sequelize.authenticate();\n        connect.then(function(){\n            return done(null, sql_obj);\n        });\n        connect.catch(function (err) {\n            sql_obj.delete();\n            return done(err);\n        });\n    }else{\n        sql_connections[id][dialect].clearTimeout();\n        if (typeof sql_connections==\"undefined\" || typeof sql_connections[id]==\"undefined\" || typeof sql_connections[id][dialect]==\"undefined\") {\n            connect_sql(id, config, done);\n        } else {\n            done(null, sql_connections[id][dialect]);\n        };\n    };\n};",
            "DataName": "UtilSQL",
            "DataType": 1,
            "LanguageName": "Node",
            "LanguageVersion": "12.18.3"
        },
        {
            "Data": "const util = require(\"../UtilSQL\");\r\n\r\nvar param = [[SQL_NODE_PARAMETERS]];\r\nvar id = param[0];\r\nvar config = param[1];\r\nvar timeout = param[2];\r\nvar query_sql = param[3];\r\nvar query_type = param[4];\r\nvar replacements = param[5];\r\n\r\nawait (new Promise((resolve, reject) => {\r\n\tutil.connect_sql(id, config, function connect_sql(err, sql){\r\n        if(err){\r\n            reject(err)\r\n        }else{\r\n            var sequelize = sql.sequelize;\r\n            var query = sequelize.query(query_sql, {replacements:replacements, type:query_type});\r\n            query.then(function(results){\r\n                [[SQL_NODE_PARAMETERS]] = query_type===\"RAW\" ? results : [results, \"\"];\r\n                sql.setTimeout(timeout);\r\n                resolve();\r\n            });\r\n            query.catch(function(err){\r\n                sql.setTimeout(timeout);\r\n                reject(err);\r\n            });\r\n        };\r\n    });\r\n}));",
            "DataName": "QuerySQL",
            "DataType": 0,
            "LanguageName": "Node",
            "LanguageVersion": "12.18.3"
        },
        {
            "Data": "var id = [[SQL_NODE_PARAMETERS]];\r\n\r\nawait (new Promise((resolve, reject) => {\r\n    if(typeof sql_connections!=\"undefined\" || typeof sql_connections[id]!=\"undefined\"){\r\n        var dialects = Object.keys(sql_connections[id]);\r\n        dialects.forEach(function(dialect){\r\n            var sql = sql_connections[id][dialect];\r\n            sql.close(sql);\r\n            return;\r\n        });\r\n        resolve();\r\n    }else{\r\n        resolve();\r\n    };       \r\n}));",
            "DataName": "CloseSQL",
            "DataType": 0,
            "LanguageName": "Node",
            "LanguageVersion": "12.18.3"
        }
    ],
    "engine": [
        "engine.js"
    ],
    "icon": "SQL.png",
    "info": {
        "en": "Module for working with SQL databases (Postgres, MySQL, MariaDB, SQLite, MSSQL).",
        "ru": "Модуль для работы с SQL базами данных (Postgres, MySQL, MariaDB, SQLite, MSSQL)."
    },
    "is_autogenerated": true,
    "languages": [
        {
            "Name": "Node",
            "Version": "12.18.3"
        }
    ],
    "localize": {
		"Port": {"ru":"Порт"},
		"is empty": {"ru":"пуст"},
		"Username": {"ru":"Логин"},
		"Timeout": {"ru":"Таймаут"},
		"Password": {"ru":"Пароль"},
		"Host name": {"ru":"Имя хоста"},
		"Database name": {"ru":"Имя базы данных"},
		"Can be blank": {"ru":"Может быть пустым"},
		"Database port.": {"ru":"Порт базы данных."},
		"Timeout (seconds)": {"ru":"Таймаут (секунд)"},
		"Database dialect": {"ru":"Диалект базы данных"},
		"Database storage": {"ru":"Хранилище базы данных"},
		"Dialect of SQL database.": {"ru":"Диалект SQL базы данных."},
		"Username of the database.": {"ru":"Имя пользователя базы данных."},
		"Password of the database.": {"ru":"Пароль пользователя базы данных."},
		"Host (URL or IP) of the database.": {"ru":"Хост (URL или IP) базы данных."},
		"Setup access to SQL database.": {"ru":"Настроить доступ к SQL базе данных."},
		"Default port for PostgreSQL dialect": {"ru":"Порт по умолчанию для диалекта PostgreSQL"},
		"Default port for MicrosoftSQL dialect": {"ru":"Порт по умолчанию для диалекта MicrosoftSQL"},
		"Automatically detect port based on dialect": {"ru":"Автоматически определять порт по диалекту"},
		"Default port for MySQL and MariaDB dialects": {"ru":"Порт по умолчанию для диалектов MySQL и MariaDB"},
		"The path to the database storage. Only used by SQLite.": {"ru":"Путь к хранилищу базы данных. Используется только SQLite."},
		"This action should be called once before any other action that works with the SQL database.": {"ru":"Это действие нужно вызвать один раз перед любым другим действием, которое работает с SQL базой данных."},
        "If a resource is specified in the \"Database storage\" parameter, resource location will be used.": {"ru":"Если в параметре \"Хранилище базы данных\" указан ресурс, вместо содержимого ресурса будет браться его расположение."},
        "This action won't start connection, it only sets configuration. Connection will be established after first attempt to access the database. When action, which triggers connection will be finished, connection won't be closed immediately. It will be preserved for a time specified in this parameter. If another action will require access to database, connection will be reused.": {"ru":"Это действие не устанавливает соединение сразу. Соединение будет установлено только после первой попытки доступа к базе. Когда действие, запускающее соединение, будет завершено, соединение не будет закрыто. Оно будет храниться в течение времени, указанного в этом параметре. Если другое действие снова потребует доступа к базе, соединение будет повторно использовано."},
        "This action won't start connection, it only sets configuration. Connection will be established after first attempt to access the database. When action, which triggers connection will be finished, connection won't be closed immediately. It will be preserved for a time specified in \"Timeout\" parameter. If another action will require access to database, connection will be reused.": {"ru":"Это действие не устанавливает соединение сразу. Соединение будет установлено только после первой попытки доступа к базе. Когда действие, запускающее соединение, будет завершено, соединение не будет закрыто. Оно будет храниться в течение времени, указанного в параметре \"Таймаут\". Если другое действие снова потребует доступа к базе, соединение будет повторно использовано."},
		
		"Query": {"ru":"Запрос"},
		"Results": {"ru":"Результаты"},
		"Metadata": {"ru":"Метаданные"},
		"Query type": {"ru":"Тип запроса"},
		"Do not process query results": {"ru":"Не обрабатывать результаты запроса"},
		"Automatically detect query type": {"ru":"Автоматически определять тип запроса"},
		"The query to be executed against the database.": {"ru":"Запрос который нужно выполнить к базе данных."},
		"Execute an arbitrary query against an SQL database.": {"ru":"Выполнить произвольный запрос к SQL базе данных."},
		"Metadata will be received only for \"RAW\" query type.": {"ru":"Метаданные будут получены только при \"RAW\" типе запроса."},
		"The type of query you are executing. The query type affects how results are formatted.": {"ru":"Тип выполняемого запроса. Тип запроса влияет на форматирование результатов."},
		"Variable in which, after successful execution of the action, the metadata will be written.": {"ru":"Переменная в которую, после успешного выполнения действия, будет записаны метаданные."},
		"In order to execute this action correctly you need to run \"Setup connection\" action first.": {"ru":"Для правильной работы необходимо сначала выполнить действие \"Настроить соединение\"."},
		"Variable in which, after successful execution of the action, the results of the query will be written.": {"ru":"Переменная в которую, после успешного выполнения действия, будет записаны результаты выполнения запроса."},
		"If an error occurred while execute action, the thread will stop with fail message. If you want to continue thread, use \"Ignore errors\" action.":{"ru":"Если во время выполнения действия произойдет ошибка, поток остановится с сообщением об ошибке. Если вы хотите продолжить работу, используйте действие \"Игнорировать ошибки\"."},
		
		"Close connection to SQL database.": {"ru":"Закрыть соединение с SQL базой данных."},
		"If connection is already closed or not open yet, this action will do nothing.": {"ru":" Если соединение уже закрыто или ещё не открыто, это действие ничего не сделает."},
        "Exact autoclose timeout is specified in \"Setup connection\" action.":{"ru":"Точный значение максимального времени ожидания можно задать в действии \"Настроить соединение\"."},
        "This action is optional because connection is closed automatically if it is not used for a long time.": {"ru":"Это действие не является обязательным, так как соединение закрывается автоматически если оно не использовалось длительное время."}
    },
    "major_version": 1,
    "minor_version": 0,
    "modules": [
        {
            "LanguageName": "Node",
            "LanguageVersion": "12.18.3",
            "ModuleName": "sequelize",
            "ModuleVersion": "*"
        },
        {
            "LanguageName": "Node",
            "LanguageVersion": "12.18.3",
            "ModuleName": "mysql2",
            "ModuleVersion": "*"
        },
        {
            "LanguageName": "Node",
            "LanguageVersion": "12.18.3",
            "ModuleName": "mariadb",
            "ModuleVersion": "*"
        },
        {
            "LanguageName": "Node",
            "LanguageVersion": "12.18.3",
            "ModuleName": "tedious",
            "ModuleVersion": "*"
        },
        {
            "LanguageName": "Node",
            "LanguageVersion": "12.18.3",
            "ModuleName": "pg",
            "ModuleVersion": "*"
        },
        {
            "LanguageName": "Node",
            "LanguageVersion": "12.18.3",
            "ModuleName": "pg-hstore",
            "ModuleVersion": "*"
        },
        {
            "LanguageName": "Node",
            "LanguageVersion": "12.18.3",
            "ModuleName": "sqlite3-offline",
            "ModuleVersion": "*"
        }
    ],
    "name": "SQL"
}
